<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="Hugo 0.26" />
    <link rel="shortcut icon" href="/dennismao.github.io/images/favicon.ico">
    <link href="dennismao.github.io/index.xml" rel="alternate" type="application/rss+xml" title="行者小筑" />
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
    <script src="https://apis.google.com/js/platform.js" async defer>{lang: 'ja'}</script>
    
    <link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
    <script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <link rel="stylesheet" type="text/css" href="/dennismao.github.io/css/style.css">
    <title>2017 Go语言使用总结 | 行者小筑</title>
  </head>
  <body>
    <div id="wrap">
      
      <header class="site-header">
        <div class="site-header-left">
          <a class="site-header-title" href="dennismao.github.io">行者小筑</a>
           <p id="author-tar">技术方向:服务器应用、分布式系统</p>  
        </div>
      </header>
      <div class="container">
        <div id="main">

<div class="article">
  <header>
    <div class="article-header">
      <h1>2017 Go语言使用总结</h1>
      <div class="article-meta">
        <span class="posttime">2018/01/28</span>
        
<div class="tags">
  <ul>
    
    <li>
        <a href="/dennismao.github.io/tags/%E9%9A%8F%E7%AC%94">随笔</a>
    </li>
    
  </ul>
</div>


      </div>
    </div>
    
<div id="share-buttons">
  <ul>
    
    
    
    
    
    
  </ul>
</div>


  </header>
  <div class="content">
      <span>目录</span>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#语法风格简单">语法风格简单</a></li>
<li><a href="#支持跨平台">支持跨平台</a></li>
<li><a href="#高性能-低消耗-易部署">高性能、低消耗、易部署</a></li>
<li><a href="#坑">坑</a>
<ul>
<li><a href="#滥用协程">滥用协程</a></li>
<li><a href="#第三方包质量">第三方包质量</a></li>
<li><a href="#生态">生态</a></li>
</ul></li>
<li><a href="#总结">总结</a></li>
</ul></li>
</ul>
</nav>
    

<p>到了年末，谈谈这一年的收获与坑。<br />
所参与的项目从C++转到Go有两年，产品今年已经正式投入到线上商用运行。自己也从刚开始的基础模块设计开发，逐渐转到上层业务的开发。从底层到业务层的转变，对语言的需求和看法，也了有一定的变化。作为小coder，谈谈这年在实际项目中用Go语言的一些心得和踩坑经历。</p>

<h2 id="语法风格简单">语法风格简单</h2>

<p>Go在开发方面很吸引人的一点就是语法简单，容易上手。组里的同事基本都是从C++和JAVA两个方向转到Go语言来开发这个项目。通过相互沟通，大家普通花了一个月时间左右熟悉这门语言并能上手进行开发实际模块。因为有官方的<strong>gofmt</strong>格式化工具，大家的代码风格都基本与《effective go》中的相近。这点好处就是非常有效地提高code review的效率和效果。</p>

<p>关于网上的一直争议的错误处理，团队也有过讨论。讨论的结果就是两种方案有原则的并存,根据业务情况进行选择。
在一般流程中，使用独立的错误处理</p>

<pre><code>if err := func();err != nil {
    return err 
}
</code></pre>

<p>在业务流中，使用统一的错误处理</p>

<pre><code>func xx() (err error) {
	defer func() {
		if err != nil {
			collcetErr(err)
			return
		}
	}()

    return 
}
</code></pre>

<h2 id="支持跨平台">支持跨平台</h2>

<p>在go 1.5后，语言原生支持了跨平台编译，通过设置环境参数<strong>GOOS</strong>和<strong>GOARCH</strong>,直接go build，即可非常便捷地进行跨平台编译。如果代码中有需要加入CGO的东西，则会稍麻烦些。与所在操作系统一下，安装支持跨平台编辑gcc，在go env中配置好<strong>cc</strong>的参数即可。由于项目需要兼容多种环境，支持跨平台编辑还是非常便于开发和部署管理。</p>

<h2 id="高性能-低消耗-易部署">高性能、低消耗、易部署</h2>

<p>实际项目使用中最明显的应该是它的运行效率非常高、内存消耗低和直接可以生成可执行文件部署起来十分便捷。生成出的可执行文件体积很小，生成docker container体积相比起java的也是小不少。
当然效率高和消耗低与开发是密切相关的。前期在对语言使用上还不够理解深入的情况下，开发过程中会有出现部分内存泄漏、GC过频等情况。通过官方提供的pprof、test包和benchmark工具，搭配像<a href="https://github.com/uber/go-torch">flamegraph</a>等工具。可以高效地进行程序的漏洞修复和性能调优。</p>

<p>有了上述的优点，团队也开始考虑能否能进一步拓宽Go语言的应用领域，往物联网和其他硬件相关的领域发展。</p>

<h2 id="坑">坑</h2>

<p>说完了优点，再说说开发和应用过程中，踩过的坑和一些解决方法。</p>

<h3 id="滥用协程">滥用协程</h3>

<p>由于在绝大部分介绍中都强调了Go的goroutine优势，在前面的优点讲述中就不再过多描述。但是正因为Go开协程是如此便捷，在初期开发时，会遇到在底层模块中滥用goroutine的现象。部分协程由于开了后，跑完主任务却没有正确关闭，资源一直被占用。
对于这种解决方法有三个。
(1)针对编程习惯上，参考了官方的并发模型，对代码质量进行规范，加强code review中这部分的检查。通过runtime/pprof包能十分便捷有效地查看当前的goroutine信息，判断是否有异常和未正确关闭的协程。
(2)引入context包进行上下文控制，在并发模型中有cancel和wait模型，底层模块我们更多选择的是cancel模型来规范和解决goroutine管理的问题。但是在业务流程调用的时候会偏向于选择wait模型。
(3)构建集中的任务管理器包，采用注册的方式对需要用到goroutine的任务采用wait模型进行管理。</p>

<h3 id="第三方包质量">第三方包质量</h3>

<p>虽然官方的底层操作库已经十分完善，但在系统整个开发过程中难免会用到第三方包。而第三方包的质量问题一直存开发过程中。由于Go语言还属于一门新的语言，跟JAVA和C++相比，相关的第三方功能包都不是那么完善，在蓬勃发展中。所以在当前需要使用第三方包还是要格外慎重，决定引入之前需要根据项目需求进行深入测试。
这个问题主要影响是的开发的进度。底层组件开发过程，修复第三方包花费了一定时间。</p>

<p>下面整理了第三方包容易存在的一些问题:
+ 多系统环境兼容性: 第三方包容易出现只支持某个系统，多系统的兼容在设计初并未考虑到
+ 版本控制: 早期包很多未采用版本控制，当第三方包内由引入其他包时候直接<strong>go get -u</strong>会引发各种奇怪问题。所以在进行二次开发时候注意增加像<strong>dep</strong>,<strong>glide</strong>这种，包的版本控制工具。
+ CGO: 有部分包因为调用了c++/c的代码引入了cgo，在开发过程中着重检查其中的c/c++代码正确性。
+ Go语言版本: 部分包会使用到一些新语法特性,像1.9的sync.map。但如果主代码编译环境与第三方包不同步时会存在编译不通过的问题，需要兼容性修改。
+ 性能: 部分开源组件提供的Go语言接口包部分的实现并不是最优解，也没有紧跟语言版本同步更新，引入新特性。所以在实现高性能底层组件的时候需要花点时间优化这些接口包。</p>

<h3 id="生态">生态</h3>

<p>在进行基础模块开发的过程中，Go语言带给我的感觉是简洁和轻快。设计和编码习惯可以很好继承C语言，语言轻，但是我们能用它能清晰地完成很复杂的逻辑。大概是缘因这些特点，大厂们选择用Go语言来开发像docker、k8s、prometheus、influxdb和eth等这些复杂项目。</p>

<p>但在业务模块开发中，Go语言却未能带给很好体验。由于业务需要，团队尝试采用Go进行类ERP系统的开发，这种强业务型的需求一向是JAVA的优势。所以选择使用Go语言来开发也是一项尝试。实际开发过程中，没有JAVA的SSH全家桶，对于业务流的开发效率会比JAVA低不少。经过分析，主要问题出于缺少完整的业务框架。因此我们选择应用JAVA的开发经验，进行Go语言的业务框架研发。</p>

<h2 id="总结">总结</h2>

<p>经过一年的工程应用，对语言有了进一步认识。自己的总结就是Go的使用跟C一样，正因为语法简单，贴近底层，若侧重开发基础组件，则更需要增加像数据结构、算法和操作系统的基础的学习，若侧重应用服务，则需要更优秀的设计架构基础。通过与其他Gopher的沟通，国内越来越多公司正因看中了Go语言鲜明的优点，逐步把后端业务转向Go语言。大家都处在摸索和成长过程中。自己也希望随着对语言理解的深入，能把Go应用到更多领域。</p>

  </div>
  <footer>
    <div class="article-footer">
      
<div class="tags">
  <ul>
    
    <li>
        <a href="/dennismao.github.io/tags/%E9%9A%8F%E7%AC%94">随笔</a>
    </li>
    
  </ul>
</div>


      
      
<div id="share-buttons">
  <ul>
    
    
    
    
    
    
  </ul>
</div>


      
      
      <div id="pagenavigation-next-prev">
        
        <div id="pagenavigation-next">
          <span class="pagenav-label">Previous</span>
          <a href="dennismao.github.io/post/2018/01/build-blog-by-hugo-and-travisci-on-gitpages/">使用TravisCI持续部署Hugo博客到gitpages</a>
        </div>
        
        
      </div>
      
    </div>
  </footer>
</div>
        </div>
        <div class="sidebar">
  
  
  <div class="sidebar-content">
    <div class="sidebar-header">
      <span>Author</span>
    </div>
    <div id="author">
      <img id="author-avatar" src=https://gss0.baidu.com/9vo3dSag_xI4khGko9WTAnF6hhy/zhidao/pic/item/5d6034a85edf8db10237879c0e23dd54564e7429.jpg>     
      <span id="author-name">Razil</span>
        </br>
      <span id="author-lang">语言:C/C&#43;&#43;/Go </span>    
      <span id="author-tar">技术方向:服务器应用、分布式系统</span>  
      <div>
        
        
        <a href="https://github.com/github.com/dennismao"><i class="fa fa-github-square fa-2x" aria-hidden="true"></i></a>
        
        
        
      </div>
    </div>
  </div>
  
  
  <div class="sidebar-content">
    <div class="sidebar-header">
      <span>Categories</span>
    </div>
    <div class="categories">
      <ul>
        
        <li>
          <a href="/dennismao.github.io/categories/docker"><span></span>docker (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/go"><span></span>go (7)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/golang"><span></span>golang (5)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/rpc"><span></span>rpc (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0"><span></span>使用手记 (4)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F"><span></span>分布式 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/%E5%AF%86%E7%A0%81%E5%AD%A6"><span></span>密码学 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93"><span></span>数据库 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/%E6%B1%87%E6%80%BB"><span></span>汇总 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/%E8%AF%91%E6%96%87"><span></span>译文 (2)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0"><span></span>阅读笔记 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/categories/%E9%9A%8F%E7%AC%94"><span></span>随笔 (1)</a>
        </li>
        
      </ul>
    </div>
  </div>
  
    
  
  <div class="sidebar-content">
    <div class="sidebar-header">
      <span>Tags</span>
    </div>
    <div class="categories">
      <ul>
        
        <li>
          <a href="/dennismao.github.io/tags/"><span></span> (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/beego"><span></span>beego (2)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/context"><span></span>context (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/docker"><span></span>docker (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/elasticsearch"><span></span>elasticsearch (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/go"><span></span>go (2)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/golang"><span></span>golang (3)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/grpc"><span></span>grpc (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/influxdb"><span></span>influxdb (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/json"><span></span>json (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/orm"><span></span>orm (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/relfect"><span></span>relfect (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/rpc"><span></span>rpc (2)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/web"><span></span>web (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/websocket"><span></span>websocket (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/%E4%BD%BF%E7%94%A8%E6%89%8B%E8%AE%B0"><span></span>使用手记 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F"><span></span>分布式 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/%E5%8A%A0%E5%AF%86"><span></span>加密 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/%E6%AD%A3%E5%88%99"><span></span>正则 (2)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span></span>正则匹配 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/%E6%B1%87%E6%80%BB"><span></span>汇总 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB"><span></span>网络爬虫 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA"><span></span>自动化构建 (1)</a>
        </li>
        
        <li>
          <a href="/dennismao.github.io/tags/%E9%9A%8F%E7%AC%94"><span></span>随笔 (1)</a>
        </li>
        
      </ul>
    </div>
  </div>
  
    
  <div class="sidebar-content">
    <div class="sidebar-header">
      <span>RSS</span>
    </div>
    <div id="rss">
      <a href="dennismao.github.io/index.xml" type="application/rss+xml" target="_blank">
        <i class="fa fa-rss-square fa-2x" aria-hidden="true"></i>
      </a>
    </div>
  </div>
</div>

      </div>
      <footer>
        <div id="site-footer-wrap">
          <div id="site-footer">
            <span>Powered by <a href="https://gohugo.io/">Hugo</a>.</span>
            <span>
              
              Copyright (c) 2018, <a href="dennismao.github.io">行者小筑</a>
              
            </span>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>

